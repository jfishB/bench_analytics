# ğŸš€ Render Deployment Guide - Django Backend

## âœ… What's Been Prepared

Your Django backend is now ready for production deployment on Render with the following changes:

### 1. **Added Production Dependencies**
- `gunicorn>=21.0.0` - Production WSGI server
- `dj-database-url>=2.0.0` - PostgreSQL connection URL parser

### 2. **Updated Django Settings**
- âœ… Added `DATABASE_URL` support for Render's auto-linked databases
- âœ… Added `STATIC_ROOT` configuration for static files
- âœ… Updated CORS settings to be secure in production
- âœ… Environment-based configuration already in place

### 3. **Created Data Migration**
- âœ… Automatic loading of Blue Jays players from CSV on first deploy
- Migration file: `backend/roster/migrations/0010_load_initial_players.py`

---

## ğŸ—„ï¸ Step 1: Create PostgreSQL Database

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click **"New +"** â†’ **"PostgreSQL"**
3. Configure:
   - **Name**: `bench-analytics-db`
   - **Database**: `bench_analytics`
   - **Region**: Same as your backend (Oregon US West recommended)
   - **Plan**: Free or Starter
4. Click **"Create Database"**
5. Wait for it to provision (takes ~1 minute)

---

## ğŸ”— Step 2: Configure Backend Service

### **A. Link the Database**

1. Go to your **backend service** (`bench_analytics_backend`)
2. Click **"Environment"** tab
3. Click **"Add Environment Variable"**
4. Click **"Add from database"**
5. Select your PostgreSQL database
6. Render will automatically add `DATABASE_URL`

### **B. Add Required Environment Variables**

Add these environment variables in the **Environment** tab:

```bash
# Security (REQUIRED)
SECRET_KEY=<generate-using-command-below>
DEBUG=False
ALLOWED_HOSTS=bench-analytics-backend.onrender.com

# Database (automatically added if you linked the database)
DATABASE_URL=<auto-generated-by-render>
```

#### Generate SECRET_KEY:
Run this on your local machine:
```bash
python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
```

Copy the output and paste it as the `SECRET_KEY` value.

---

## âš™ï¸ Step 3: Configure Build Commands

In your backend service **Settings** tab:

### **Root Directory**
```
.
```
(or leave empty - means repository root)

### **Build Command**
```bash
pip install -r requirements.txt
```

### **Pre-Deploy Command**
```bash
python backend/manage.py migrate --noinput
```
This runs migrations and loads initial player data before starting the server.

### **Start Command**
```bash
gunicorn --chdir backend config.wsgi:application --bind 0.0.0.0:$PORT
```

---

## ğŸŒ Step 4: Update Frontend Configuration

In your frontend deployment, set the API URL environment variable:

```
REACT_APP_API_URL=https://bench-analytics-backend.onrender.com
```

Update your frontend code to use this in API calls.

---

## ğŸ“¦ Step 5: Deploy

1. **Commit all changes**:
   ```bash
   git add .
   git commit -m "Prepare Django backend for Render deployment"
   git push origin main
   ```

2. **Render will auto-deploy** when it detects the push

3. **Monitor the logs** in Render Dashboard:
   - Watch for "Successfully loaded players" message
   - Confirm migrations ran successfully
   - Ensure server starts without errors

---

## âœ… Step 6: Verify Deployment

### Check these endpoints:

1. **Health check**: `https://bench-analytics-backend.onrender.com/`
2. **Players API**: `https://bench-analytics-backend.onrender.com/api/roster/players/`
3. **Admin** (if enabled): `https://bench-analytics-backend.onrender.com/admin/`

### Test in Shell (optional):

1. Go to backend service â†’ **Shell** tab
2. Run:
   ```bash
   python backend/manage.py shell
   ```
3. Check players loaded:
   ```python
   from roster.models import Player
   print(Player.objects.count())  # Should show ~17 Blue Jays players
   print(Player.objects.first().name)
   ```

---

## ğŸ¯ What Users Will See

- **Global Shared Database**: All users will see the same players
- **Pre-loaded Blue Jays Data**: 17 players automatically loaded on first deploy
- **Persistent Data**: Data survives service restarts and redeployments

---

## ğŸ”§ Troubleshooting

### Build Fails: "Could not open requirements file"
- **Fix**: Ensure Root Directory is set to `.` or empty

### Build Fails: "connection to server... failed"
- **Fix**: Run migrations in Pre-Deploy Command, not Build Command
- Pre-Deploy Command has access to the database, Build Command doesn't

### Players Not Loading
- Check logs for "Loading players from..." message
- Verify CSV file exists at `data/test_dataset_monte_carlo_bluejays.csv`
- Run migration manually in Shell: `python backend/manage.py migrate`

### CORS Errors
- Add your frontend domain to `ALLOWED_HOSTS` environment variable
- Verify `DEBUG=False` is set

---

## ğŸ“ Environment Variables Summary

| Variable | Value | Required |
|----------|-------|----------|
| `DATABASE_URL` | Auto-generated by Render | Yes |
| `SECRET_KEY` | Generate random 50+ char string | Yes |
| `DEBUG` | `False` | Yes |
| `ALLOWED_HOSTS` | `bench-analytics-backend.onrender.com` | Yes |

---

## ğŸ‰ You're Done!

Your Django backend is now production-ready with:
- âœ… Secure environment configuration
- âœ… Production-ready database
- âœ… Pre-loaded player data
- âœ… Proper CORS configuration
- âœ… Static files support

All users will now share the same production database with the Blue Jays roster!


